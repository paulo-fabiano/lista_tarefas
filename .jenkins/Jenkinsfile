pipeline {

    agent {
        docker {
            image 'docker:20.10-dind'
            args '--privileged'
            args '-v /var/run/docker.sock:/var/run/docker.sock'
        }
    }

    stages {

        stage('Testes Unitários') {
            steps {
                echo 'Rodando testes unitários'
            }
        }
        stage('Testes de Integração') {
            steps {
                echo 'Rodando testes de integração'
            }
        }
        stage('SAST Trivy') {
            steps {
                echo 'Rodando SAST'
            }
        }
        // Build da Imagem Docker
        stage('Build Backend Image') { 
             // Steps
            steps {
               sh 'docker build -t paulofabiano/lista-tarefas:v1 -f Dockerfile.Spring .' 
            }
        }

    }

}